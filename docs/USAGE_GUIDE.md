# Usage Guide

## TUI (Advanced Only)

- Launch advanced TUI:
  - `equitrcoder tui` (no flags needed)
  - Startup screen lets you pick Supervisor, Worker, Mode, and enter your first task
  - In-chat changes via:
    - `/set supervisor <model>`
    - `/set worker <model>`
    - `/set mode <single|multi-parallel|multi-seq|research>`

In research mode, the startup flow is the same; experiments and datasets are handled programmatically.

The TUI will run the full researcher flow and the final Markdown report is generated by the supervisor model automatically.

## CLI

- Single:
  - `equitrcoder single "Implement feature X" --model moonshot/kimi-k2-0711-preview`
- Multi (parallel by default):
  - `equitrcoder multi "Implement system Y" --supervisor-model moonshot/kimi-k2-0711-preview --worker-model moonshot/kimi-k2-0711-preview --workers 3 --team backend_dev,frontend_dev,qa_engineer`
- Multi (sequential execution):
  - `equitrcoder multi "Implement system Y" --supervisor-model moonshot/kimi-k2-0711-preview --worker-model moonshot/kimi-k2-0711-preview --workers 3 --team backend_dev,frontend_dev,qa_engineer --execution-mode sequential`
- Research (ML only):
  - `equitrcoder research "Evaluate model on dataset" --supervisor-model moonshot/kimi-k2-0711-preview --worker-model moonshot/kimi-k2-0711-preview --workers 3 --team ml_researcher,data_engineer,experiment_runner`
  - Team defaults: `ml_researcher,data_engineer,experiment_runner`
  - Supervisor model outputs `research_report.md` in the session docs folder.
- Tools management:
  - `equitrcoder tools --list` (List available tools)
  - `equitrcoder tools --discover` (Discover and register tools)
- Models listing:
  - `equitrcoder models` (List all AI models)
  - `equitrcoder models --provider openai` (Filter by provider)
- API server:
  - `equitrcoder api --host localhost --port 8000` (Start REST API server)

## Programmatic

Use `ResearchTaskConfiguration` for ML research mode with optional non-interactive context:

```python
from equitrcoder.programmatic.interface import EquitrCoder, ResearchTaskConfiguration

coder = EquitrCoder(repo_path=".", mode="research")
config = ResearchTaskConfiguration(
  description="Evaluate ABC on DEF",
  supervisor_model="moonshot/kimi-k2-0711-preview",
  worker_model="moonshot/kimi-k2-0711-preview",
  team=["ml_researcher", "data_engineer", "experiment_runner"],
  research_context={
    "datasets": [{"path": "./data", "description": "local dataset"}],
    "experiments": [
      {"name": "baseline", "command": "python train.py --dataset data"},
      {"name": "variant", "command": "python train.py --dataset data --flag"}
    ]
  }
)
result = await coder.execute_task(config.description, config)

## MCP Servers

- Install optional dependency to enable MCP:

```bash
pip install modelcontextprotocol
```

- Create `~/.EQUITR-coder/mcp_servers.json` (or set `EQUITR_MCP_SERVERS`):

```json
{
  "mcpServers": {
    "sqlite": { "command": "uvx", "args": ["mcp-server-sqlite", "--db-path", "./test.db"], "transport": "stdio" }
  }
}
```

- After startup, tools named `mcp:<serverName>` appear and can call any tool on that server via `{ "tool": "<name>", "arguments": { ... } }`.

```

See also external programmatic example: `examples/research_programmatic_example.py`.

## Security & Sandboxing

- All examples create a unique subfolder under `generated_projects/<name>_<timestamp>` and set the working directory to that folder.
- Built-in file system and shell tools are restricted to the current working directory and cannot escape the project folder.
- Absolute paths and path traversal attempts are blocked. Commands that attempt to change directories outside the sandbox are rejected.